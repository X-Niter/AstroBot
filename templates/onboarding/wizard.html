{% extends "base.html" %}

{% block title %}AstroBot AI Onboarding Wizard{% endblock %}

{% block styles %}
<style>
    .wizard-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .wizard-step {
        display: none;
    }
    
    .wizard-step.active {
        display: block;
    }
    
    .wizard-nav {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #dee2e6;
    }
    
    .wizard-progress {
        margin-bottom: 2rem;
    }
    
    .wizard-progress .progress {
        height: 8px;
    }
    
    .step-indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }
    
    .step-indicator span {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #e9ecef;
        color: #6c757d;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        z-index: 1;
        position: relative;
    }
    
    .step-indicator span.active {
        background-color: #5865F2;
        color: white;
    }
    
    .step-indicator span.completed {
        background-color: #198754;
        color: white;
    }
    
    .step-indicator-line {
        position: relative;
    }
    
    .step-indicator-line::before {
        content: '';
        position: absolute;
        top: 15px;
        left: 0;
        right: 0;
        height: 2px;
        background-color: #e9ecef;
        z-index: 0;
    }
    
    .wizard-summary {
        background-color: #f8f9fa;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .wizard-summary h4 {
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .summary-item {
        margin-bottom: 0.75rem;
    }
    
    .summary-item label {
        font-weight: bold;
        margin-bottom: 0.25rem;
    }
    
    .features-selector .card {
        cursor: pointer;
        transition: all 0.2s ease;
        height: 100%;
    }
    
    .features-selector .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .features-selector .card.selected {
        border-color: #5865F2;
        background-color: rgba(88, 101, 242, 0.05);
    }
    
    .features-selector .card.selected .card-header {
        background-color: #5865F2;
        color: white;
    }
    
    .features-selector .form-check {
        padding-left: 0;
    }
    
    .features-selector .form-check-input {
        position: absolute;
        right: 1rem;
        top: 1rem;
    }
    
    .ai-thinking {
        display: none;
        margin: 1.5rem 0;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 0.5rem;
        text-align: center;
    }
    
    .ai-thinking.visible {
        display: block;
    }
    
    .ai-recommendation {
        background-color: rgba(88, 101, 242, 0.05);
        border-left: 4px solid #5865F2;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 0 0.5rem 0.5rem 0;
    }
    
    .processing-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
    }
    
    .processing-overlay.visible {
        display: flex;
    }
    
    .dot-typing {
        position: relative;
        left: -9999px;
        width: 10px;
        height: 10px;
        border-radius: 5px;
        background-color: white;
        color: white;
        box-shadow: 9984px 0 0 0 white, 9999px 0 0 0 white, 10014px 0 0 0 white;
        animation: dot-typing 1.5s infinite linear;
    }
    
    @keyframes dot-typing {
        0% {
            box-shadow: 9984px 0 0 0 white, 9999px 0 0 0 white, 10014px 0 0 0 white;
        }
        16.667% {
            box-shadow: 9984px -10px 0 0 white, 9999px 0 0 0 white, 10014px 0 0 0 white;
        }
        33.333% {
            box-shadow: 9984px 0 0 0 white, 9999px 0 0 0 white, 10014px 0 0 0 white;
        }
        50% {
            box-shadow: 9984px 0 0 0 white, 9999px -10px 0 0 white, 10014px 0 0 0 white;
        }
        66.667% {
            box-shadow: 9984px 0 0 0 white, 9999px 0 0 0 white, 10014px 0 0 0 white;
        }
        83.333% {
            box-shadow: 9984px 0 0 0 white, 9999px 0 0 0 white, 10014px -10px 0 0 white;
        }
        100% {
            box-shadow: 9984px 0 0 0 white, 9999px 0 0 0 white, 10014px 0 0 0 white;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="wizard-container">
        <h1 class="text-center mb-4">AstroBot AI Onboarding Wizard</h1>
        <p class="lead text-center mb-4">Let's configure AstroBot AI to best suit your Discord server's needs. Our AI will provide personalized recommendations based on your preferences.</p>
        
        <div class="wizard-progress">
            <div class="step-indicator-line">
                <div class="step-indicator">
                    <span class="active" id="step-indicator-1">1</span>
                    <span id="step-indicator-2">2</span>
                    <span id="step-indicator-3">3</span>
                    <span id="step-indicator-4">4</span>
                    <span id="step-indicator-5">5</span>
                </div>
            </div>
            <div class="progress">
                <div class="progress-bar bg-primary" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
        
        <!-- Step 1: Server Information -->
        <div class="wizard-step active" id="step-1">
            <h3>Step 1: Tell us about your server</h3>
            <p>To provide you with personalized recommendations, we need to understand your Discord server's purpose and size.</p>
            
            <div class="mb-3">
                <label for="server-name" class="form-label">Server Name</label>
                <input type="text" class="form-control" id="server-name" placeholder="e.g., Minecraft Community Hub">
            </div>
            
            <div class="mb-3">
                <label for="server-purpose" class="form-label">Primary Server Purpose</label>
                <select class="form-select" id="server-purpose">
                    <option value="" selected disabled>Select the main purpose of your server</option>
                    <option value="gaming">Gaming Community</option>
                    <option value="minecraft">Minecraft Server</option>
                    <option value="modding">Modding Community</option>
                    <option value="streaming">Streaming/Content Creation</option>
                    <option value="general">General Community</option>
                    <option value="education">Educational</option>
                    <option value="professional">Professional/Work</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="server-size" class="form-label">Server Size</label>
                <select class="form-select" id="server-size">
                    <option value="" selected disabled>Select your server size</option>
                    <option value="small">Small (< 100 members)</option>
                    <option value="medium">Medium (100-500 members)</option>
                    <option value="large">Large (500-2000 members)</option>
                    <option value="very_large">Very Large (2000+ members)</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="activity-level" class="form-label">Activity Level</label>
                <select class="form-select" id="activity-level">
                    <option value="" selected disabled>Select your server's activity level</option>
                    <option value="low">Low (A few messages per day)</option>
                    <option value="medium">Medium (Steady conversation throughout the day)</option>
                    <option value="high">High (Active conversations all day)</option>
                    <option value="very_high">Very High (Constant activity, multiple active channels)</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="moderation-needs" class="form-label">Moderation Needs</label>
                <select class="form-select" id="moderation-needs">
                    <option value="" selected disabled>Select your moderation requirements</option>
                    <option value="minimal">Minimal (Mostly trusted members)</option>
                    <option value="standard">Standard (Occasional moderation required)</option>
                    <option value="high">High (Regular moderation required)</option>
                    <option value="very_high">Very High (Constant moderation required)</option>
                </select>
            </div>
        </div>
        
        <!-- Step 2: Feature Selection -->
        <div class="wizard-step" id="step-2">
            <h3>Step 2: Select Features</h3>
            <p>Choose which AstroBot features you're interested in. Our AI will provide personalized configuration recommendations for selected features.</p>
            
            <div class="features-selector mb-4">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100" data-feature="moderation">
                            <div class="card-header">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected-features" id="feature-moderation" value="moderation">
                                    <label class="form-check-label" for="feature-moderation">
                                        <strong>Moderation System</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Advanced moderation tools with AI-powered context analysis, multi-stage warnings, and comprehensive logs.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" data-feature="custom_commands">
                            <div class="card-header">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected-features" id="feature-custom-commands" value="custom_commands">
                                    <label class="form-check-label" for="feature-custom-commands">
                                        <strong>Custom Commands</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Create powerful custom commands with variables, conditionals, API integrations, and dynamic responses.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" data-feature="minecraft">
                            <div class="card-header">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected-features" id="feature-minecraft" value="minecraft">
                                    <label class="form-check-label" for="feature-minecraft">
                                        <strong>Minecraft Integration</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Manage Minecraft servers, view status, run console commands, and manage whitelists from Discord.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" data-feature="ai">
                            <div class="card-header">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected-features" id="feature-ai" value="ai">
                                    <label class="form-check-label" for="feature-ai">
                                        <strong>AI Features</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Leverage Claude 3.5 and GPT-4o for Q&A, mod ideas, content generation, and moderation assistance.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" data-feature="twitch">
                            <div class="card-header">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected-features" id="feature-twitch" value="twitch">
                                    <label class="form-check-label" for="feature-twitch">
                                        <strong>Twitch Integration</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Stream alerts, viewer point systems, and fully integrated Twitch-Discord experience for streamers.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" data-feature="analytics">
                            <div class="card-header">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected-features" id="feature-analytics" value="analytics">
                                    <label class="form-check-label" for="feature-analytics">
                                        <strong>Advanced Analytics</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text">Comprehensive server analytics, command usage, user activity, and moderation trend tracking.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Specific Requirements -->
        <div class="wizard-step" id="step-3">
            <h3>Step 3: Specific Requirements</h3>
            <p>Tell us more about your specific requirements. This helps our AI suggest the best configuration for your server.</p>
            
            <div id="feature-specific-questions">
                <!-- Questions will be dynamically added here based on selected features -->
                <div class="alert alert-info">
                    Please select features in the previous step to see specific configuration questions.
                </div>
            </div>
            
            <div class="mb-3">
                <label for="additional-requirements" class="form-label">Additional Requirements or Notes</label>
                <textarea class="form-control" id="additional-requirements" rows="3" placeholder="Tell us anything else that might help us customize AstroBot for your needs..."></textarea>
            </div>
        </div>
        
        <!-- Step 4: AI Recommendations -->
        <div class="wizard-step" id="step-4">
            <h3>Step 4: AI Personalized Recommendations</h3>
            
            <div class="ai-thinking" id="ai-thinking">
                <div class="d-flex align-items-center justify-content-center">
                    <div class="spinner-border text-primary me-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mb-0">Our AI is analyzing your requirements and generating personalized recommendations...</p>
                </div>
            </div>
            
            <div id="ai-recommendations">
                <!-- AI recommendations will be inserted here -->
            </div>
        </div>
        
        <!-- Step 5: Summary and Confirmation -->
        <div class="wizard-step" id="step-5">
            <h3>Step 5: Review and Confirm</h3>
            <p>Review your choices and the AI recommendations before finalizing your AstroBot configuration.</p>
            
            <div class="wizard-summary">
                <h4>Server Information</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="summary-item">
                            <label>Server Name:</label>
                            <div id="summary-server-name"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="summary-item">
                            <label>Primary Purpose:</label>
                            <div id="summary-server-purpose"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="summary-item">
                            <label>Server Size:</label>
                            <div id="summary-server-size"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="summary-item">
                            <label>Activity Level:</label>
                            <div id="summary-activity-level"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="wizard-summary">
                <h4>Selected Features</h4>
                <div id="summary-features" class="row">
                    <!-- Features will be inserted here -->
                </div>
            </div>
            
            <div class="wizard-summary">
                <h4>Configuration Summary</h4>
                <div id="summary-configuration">
                    <!-- Configuration details will be inserted here -->
                </div>
            </div>
            
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="confirm-setup">
                <label class="form-check-label" for="confirm-setup">
                    I confirm that I want to set up AstroBot with these configurations. I understand that I can make further adjustments later through the dashboard or Discord commands.
                </label>
            </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="wizard-nav">
            <button class="btn btn-secondary" id="prev-step" disabled>Previous</button>
            <button class="btn btn-primary" id="next-step">Next</button>
        </div>
    </div>
</div>

<!-- Processing Overlay -->
<div class="processing-overlay" id="processing-overlay">
    <div class="spinner-border text-light mb-3" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <h4 class="text-white mb-2">Setting up AstroBot AI</h4>
    <p class="mb-3">Please wait while we configure your bot...</p>
    <div class="dot-typing"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Variables
        let currentStep = 1;
        const totalSteps = 5;
        let serverData = {};
        let selectedFeatures = [];
        
        // Elements
        const wizardSteps = document.querySelectorAll('.wizard-step');
        const progressBar = document.querySelector('.progress-bar');
        const stepIndicators = document.querySelectorAll('.step-indicator span');
        const prevButton = document.getElementById('prev-step');
        const nextButton = document.getElementById('next-step');
        const aiThinking = document.getElementById('ai-thinking');
        const processingOverlay = document.getElementById('processing-overlay');
        
        // Feature specific elements
        const featureCards = document.querySelectorAll('.features-selector .card');
        const featureCheckboxes = document.querySelectorAll('input[name="selected-features"]');
        const featureSpecificQuestions = document.getElementById('feature-specific-questions');
        
        // Setup event listeners
        prevButton.addEventListener('click', goToPreviousStep);
        nextButton.addEventListener('click', goToNextStep);
        
        // Feature cards click handler
        featureCards.forEach(card => {
            card.addEventListener('click', function(e) {
                const checkbox = this.querySelector('input[type="checkbox"]');
                if (e.target !== checkbox) {
                    checkbox.checked = !checkbox.checked;
                }
                updateCardSelection(this, checkbox.checked);
            });
        });
        
        // Feature checkboxes change handler
        featureCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const card = this.closest('.card');
                updateCardSelection(card, this.checked);
            });
        });
        
        // Functions
        function updateCardSelection(card, isSelected) {
            if (isSelected) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        }
        
        function goToNextStep() {
            // Validate current step
            if (!validateStep(currentStep)) {
                return;
            }
            
            // Save data from current step
            saveStepData(currentStep);
            
            // Move to next step
            if (currentStep < totalSteps) {
                // If we're moving to step 3, generate feature-specific questions
                if (currentStep === 2) {
                    generateFeatureSpecificQuestions();
                }
                
                // If we're moving to step 4, simulate AI recommendation generation
                if (currentStep === 3) {
                    simulateAiRecommendation();
                }
                
                // If we're moving to step 5, generate summary
                if (currentStep === 4) {
                    generateSummary();
                }
                
                // Update step visibility
                document.getElementById(`step-${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step-${currentStep}`).classList.add('active');
                
                // Update progress bar and indicators
                updateProgress();
                
                // Update button states
                prevButton.disabled = false;
                
                // Change Next button text on last step
                if (currentStep === totalSteps) {
                    nextButton.textContent = 'Finish & Configure Bot';
                }
            } else {
                // Final step - handle form submission
                if (document.getElementById('confirm-setup').checked) {
                    submitConfiguration();
                } else {
                    alert('Please confirm that you want to set up AstroBot with these configurations.');
                }
            }
        }
        
        function goToPreviousStep() {
            if (currentStep > 1) {
                document.getElementById(`step-${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step-${currentStep}`).classList.add('active');
                
                // Update progress bar and indicators
                updateProgress();
                
                // Update button states
                prevButton.disabled = currentStep === 1;
                nextButton.textContent = 'Next';
            }
        }
        
        function updateProgress() {
            const progressPercentage = (currentStep / totalSteps) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            progressBar.setAttribute('aria-valuenow', progressPercentage);
            
            // Update step indicators
            stepIndicators.forEach((indicator, index) => {
                const stepNum = index + 1;
                indicator.classList.remove('active', 'completed');
                
                if (stepNum === currentStep) {
                    indicator.classList.add('active');
                } else if (stepNum < currentStep) {
                    indicator.classList.add('completed');
                    indicator.textContent = '✓';
                } else {
                    indicator.textContent = stepNum;
                }
            });
        }
        
        function validateStep(step) {
            switch(step) {
                case 1:
                    // Validate server information
                    const serverName = document.getElementById('server-name').value.trim();
                    const serverPurpose = document.getElementById('server-purpose').value;
                    const serverSize = document.getElementById('server-size').value;
                    const activityLevel = document.getElementById('activity-level').value;
                    const moderationNeeds = document.getElementById('moderation-needs').value;
                    
                    if (!serverName || !serverPurpose || !serverSize || !activityLevel || !moderationNeeds) {
                        alert('Please fill in all the fields to continue.');
                        return false;
                    }
                    return true;
                    
                case 2:
                    // Validate feature selection
                    const selectedFeatureCount = document.querySelectorAll('input[name="selected-features"]:checked').length;
                    if (selectedFeatureCount === 0) {
                        alert('Please select at least one feature to continue.');
                        return false;
                    }
                    return true;
                    
                case 3:
                    // Additional requirements can be optional
                    return true;
                    
                case 4:
                    // AI recommendations don't need validation
                    return true;
                    
                case 5:
                    // Final confirmation
                    return document.getElementById('confirm-setup').checked;
                    
                default:
                    return true;
            }
        }
        
        function saveStepData(step) {
            switch(step) {
                case 1:
                    // Save server information
                    serverData.name = document.getElementById('server-name').value.trim();
                    serverData.purpose = document.getElementById('server-purpose').value;
                    serverData.size = document.getElementById('server-size').value;
                    serverData.activityLevel = document.getElementById('activity-level').value;
                    serverData.moderationNeeds = document.getElementById('moderation-needs').value;
                    break;
                    
                case 2:
                    // Save selected features
                    selectedFeatures = Array.from(document.querySelectorAll('input[name="selected-features"]:checked'))
                        .map(checkbox => checkbox.value);
                    break;
                    
                case 3:
                    // Save specific requirements
                    serverData.additionalRequirements = document.getElementById('additional-requirements').value.trim();
                    
                    // Save feature-specific settings
                    selectedFeatures.forEach(feature => {
                        const featureQuestions = document.querySelectorAll(`[data-feature-section="${feature}"] select, [data-feature-section="${feature}"] input[type="text"], [data-feature-section="${feature}"] input[type="checkbox"]:checked`);
                        
                        if (!serverData.featureSettings) {
                            serverData.featureSettings = {};
                        }
                        
                        if (!serverData.featureSettings[feature]) {
                            serverData.featureSettings[feature] = {};
                        }
                        
                        featureQuestions.forEach(element => {
                            if (element.type === 'checkbox') {
                                serverData.featureSettings[feature][element.name] = element.checked;
                            } else {
                                serverData.featureSettings[feature][element.name] = element.value;
                            }
                        });
                    });
                    break;
            }
        }
        
        function generateFeatureSpecificQuestions() {
            selectedFeatures = Array.from(document.querySelectorAll('input[name="selected-features"]:checked'))
                .map(checkbox => checkbox.value);
            
            if (selectedFeatures.length === 0) {
                featureSpecificQuestions.innerHTML = `
                    <div class="alert alert-info">
                        Please select features in the previous step to see specific configuration questions.
                    </div>
                `;
                return;
            }
            
            let questionsHTML = '';
            
            // Generate feature-specific questions
            selectedFeatures.forEach(feature => {
                switch(feature) {
                    case 'moderation':
                        questionsHTML += `
                            <div class="mb-4 p-3 border rounded bg-light" data-feature-section="moderation">
                                <h4>Moderation System Configuration</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">Auto-moderation Level</label>
                                    <select class="form-select" name="automod_level">
                                        <option value="low">Low - Basic automod (links, spam)</option>
                                        <option value="medium" selected>Medium - Standard protection</option>
                                        <option value="high">High - Strict moderation</option>
                                        <option value="custom">Custom - I'll configure it manually</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">AI-powered moderation</label>
                                    <select class="form-select" name="ai_moderation">
                                        <option value="disabled">Disabled</option>
                                        <option value="assisted" selected>AI-assisted (needs human approval)</option>
                                        <option value="automatic">Fully automatic (with confidence threshold)</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Warning System</label>
                                    <select class="form-select" name="warning_system">
                                        <option value="basic">Basic (manual warnings only)</option>
                                        <option value="standard" selected>Standard (auto-escalation)</option>
                                        <option value="advanced">Advanced (context-aware, trust system)</option>
                                    </select>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="create_mod_log" id="create-mod-log" checked>
                                    <label class="form-check-label" for="create-mod-log">
                                        Create a dedicated moderation log channel
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="setup_mod_roles" id="setup-mod-roles" checked>
                                    <label class="form-check-label" for="setup-mod-roles">
                                        Set up moderator roles with appropriate permissions
                                    </label>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'custom_commands':
                        questionsHTML += `
                            <div class="mb-4 p-3 border rounded bg-light" data-feature-section="custom_commands">
                                <h4>Custom Commands Configuration</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">Command Prefix</label>
                                    <select class="form-select" name="command_prefix">
                                        <option value="!astro" selected>!astro (default)</option>
                                        <option value="!">! (simple)</option>
                                        <option value="!!">!!</option>
                                        <option value="custom">Custom prefix</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Starter Commands</label>
                                    <select class="form-select" name="starter_commands">
                                        <option value="none">None - I'll create my own</option>
                                        <option value="basic" selected>Basic set (help, info, rules)</option>
                                        <option value="gaming">Gaming-focused set</option>
                                        <option value="moderation">Moderation-focused set</option>
                                        <option value="community">Community-focused set</option>
                                        <option value="all">All available starter commands</option>
                                    </select>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_advanced_commands" id="enable-advanced-commands" checked>
                                    <label class="form-check-label" for="enable-advanced-commands">
                                        Enable advanced command features (API integration, variables)
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_command_analytics" id="enable-command-analytics" checked>
                                    <label class="form-check-label" for="enable-command-analytics">
                                        Track command usage analytics
                                    </label>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'minecraft':
                        questionsHTML += `
                            <div class="mb-4 p-3 border rounded bg-light" data-feature-section="minecraft">
                                <h4>Minecraft Integration Configuration</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">Server Type</label>
                                    <select class="form-select" name="server_type">
                                        <option value="vanilla">Vanilla</option>
                                        <option value="spigot">Spigot/Paper</option>
                                        <option value="forge" selected>Forge</option>
                                        <option value="fabric">Fabric</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Integration Level</label>
                                    <select class="form-select" name="integration_level">
                                        <option value="basic">Basic (server status, player list)</option>
                                        <option value="standard" selected>Standard (whitelist, basic commands)</option>
                                        <option value="advanced">Advanced (console access, detailed stats)</option>
                                        <option value="full">Full Integration (all features)</option>
                                    </select>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="create_server_status_channel" id="create-server-status" checked>
                                    <label class="form-check-label" for="create-server-status">
                                        Create dedicated server status channel
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_whitelist_requests" id="enable-whitelist-requests" checked>
                                    <label class="form-check-label" for="enable-whitelist-requests">
                                        Enable whitelist request system
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_server_alerts" id="enable-server-alerts" checked>
                                    <label class="form-check-label" for="enable-server-alerts">
                                        Enable server status alerts (start, stop, crashes)
                                    </label>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'ai':
                        questionsHTML += `
                            <div class="mb-4 p-3 border rounded bg-light" data-feature-section="ai">
                                <h4>AI Features Configuration</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">AI Models to Enable</label>
                                    <select class="form-select" name="ai_models">
                                        <option value="both" selected>Both Claude 3.5 and GPT-4o</option>
                                        <option value="claude">Claude 3.5 Only</option>
                                        <option value="gpt">GPT-4o Only</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Usage Limits</label>
                                    <select class="form-select" name="ai_usage_limits">
                                        <option value="low">Low (conserve tokens, ~10 queries/day)</option>
                                        <option value="medium" selected>Medium (balanced, ~50 queries/day)</option>
                                        <option value="high">High (unlimited for admins, limits for users)</option>
                                        <option value="unlimited">Unlimited (no restrictions)</option>
                                    </select>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="create_ai_channel" id="create-ai-channel" checked>
                                    <label class="form-check-label" for="create-ai-channel">
                                        Create dedicated AI interaction channel
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_image_generation" id="enable-image-generation" checked>
                                    <label class="form-check-label" for="enable-image-generation">
                                        Enable image generation with DALL-E
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_ai_moderation" id="enable-ai-moderation" checked>
                                    <label class="form-check-label" for="enable-ai-moderation">
                                        Use AI for content moderation assistance
                                    </label>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'twitch':
                        questionsHTML += `
                            <div class="mb-4 p-3 border rounded bg-light" data-feature-section="twitch">
                                <h4>Twitch Integration Configuration</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">Twitch Integration Level</label>
                                    <select class="form-select" name="twitch_integration_level">
                                        <option value="basic">Basic (stream announcements only)</option>
                                        <option value="standard" selected>Standard (announcements, alerts, chat relay)</option>
                                        <option value="advanced">Advanced (points system, rewards, full integration)</option>
                                    </select>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="create_stream_announcements" id="create-stream-announcements" checked>
                                    <label class="form-check-label" for="create-stream-announcements">
                                        Create stream announcements channel
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_points_system" id="enable-points-system" checked>
                                    <label class="form-check-label" for="enable-points-system">
                                        Enable viewer points system
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_chat_relay" id="enable-chat-relay">
                                    <label class="form-check-label" for="enable-chat-relay">
                                        Enable Twitch-Discord chat relay
                                    </label>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'analytics':
                        questionsHTML += `
                            <div class="mb-4 p-3 border rounded bg-light" data-feature-section="analytics">
                                <h4>Analytics Configuration</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">Analytics Detail Level</label>
                                    <select class="form-select" name="analytics_detail">
                                        <option value="basic">Basic (essential metrics only)</option>
                                        <option value="standard" selected>Standard (comprehensive metrics)</option>
                                        <option value="advanced">Advanced (all metrics, detailed reports)</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Data Retention</label>
                                    <select class="form-select" name="data_retention">
                                        <option value="30d">30 days</option>
                                        <option value="90d" selected>90 days</option>
                                        <option value="180d">180 days</option>
                                        <option value="365d">1 year</option>
                                    </select>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="enable_activity_reports" id="enable-activity-reports" checked>
                                    <label class="form-check-label" for="enable-activity-reports">
                                        Send periodic activity reports to admins
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="track_user_retention" id="track-user-retention" checked>
                                    <label class="form-check-label" for="track-user-retention">
                                        Track user retention metrics
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" name="track_command_usage" id="track-command-usage" checked>
                                    <label class="form-check-label" for="track-command-usage">
                                        Track command usage statistics
                                    </label>
                                </div>
                            </div>
                        `;
                        break;
                }
            });
            
            featureSpecificQuestions.innerHTML = questionsHTML;
        }
        
        function simulateAiRecommendation() {
            // Show AI thinking animation
            aiThinking.classList.add('visible');
            nextButton.disabled = true;
            prevButton.disabled = true;
            
            // Simulate AI processing time
            setTimeout(() => {
                generateAiRecommendations();
                aiThinking.classList.remove('visible');
                nextButton.disabled = false;
                prevButton.disabled = false;
            }, 3000);
        }
        
        function generateAiRecommendations() {
            // Generate recommendations based on server info and selected features
            const aiRecommendationsElement = document.getElementById('ai-recommendations');
            let recommendationsHTML = '';
            
            // General recommendations
            recommendationsHTML += `
                <div class="ai-recommendation mb-4">
                    <h4>General Recommendations</h4>
                    <p>Based on your ${serverData.purpose} server with ${serverData.size} size and ${serverData.activityLevel} activity level, I recommend the following configuration:</p>
                    
                    <ul>
            `;
            
            // Server size specific recommendations
            if (serverData.size === 'small') {
                recommendationsHTML += `
                    <li>Keep your bot configuration simple initially, focusing on core features most valuable to your community</li>
                    <li>Start with basic moderation settings since your member count is manageable</li>
                    <li>Consider implementing engagement features to help grow your community</li>
                `;
            } else if (serverData.size === 'medium') {
                recommendationsHTML += `
                    <li>Implement a structured channel organization with clear categories</li>
                    <li>Set up role-based permissions with at least 3-4 member tiers</li>
                    <li>Consider active moderation tools like auto-moderation for spam and inappropriate content</li>
                `;
            } else if (serverData.size === 'large' || serverData.size === 'very_large') {
                recommendationsHTML += `
                    <li>Implement comprehensive auto-moderation with AI assistance</li>
                    <li>Set up a detailed hierarchy of roles with clear permissions</li>
                    <li>Create dedicated channels for different activities and interests</li>
                    <li>Establish a team of moderators with specialized responsibilities</li>
                    <li>Consider implementing verification systems for new members</li>
                `;
            }
            
            recommendationsHTML += `
                    </ul>
                </div>
            `;
            
            // Feature-specific recommendations
            selectedFeatures.forEach(feature => {
                switch(feature) {
                    case 'moderation':
                        recommendationsHTML += `
                            <div class="ai-recommendation mb-4">
                                <h4>Moderation System Recommendations</h4>
                                <p>For a ${serverData.size} server with ${serverData.moderationNeeds} moderation needs:</p>
                                
                                <ul>
                        `;
                        
                        if (serverData.moderationNeeds === 'minimal') {
                            recommendationsHTML += `
                                <li>Configure basic auto-moderation for spam and explicit content</li>
                                <li>Set up a simple warning system</li>
                                <li>Create a mod-log channel for transparency</li>
                            `;
                        } else if (serverData.moderationNeeds === 'standard') {
                            recommendationsHTML += `
                                <li>Enable AI-assisted moderation for context-aware enforcement</li>
                                <li>Set up a multi-stage warning system with escalating consequences</li>
                                <li>Configure auto-mod for spam, inappropriate content, and raid protection</li>
                                <li>Create dedicated channels for moderation logs and appeals</li>
                            `;
                        } else if (serverData.moderationNeeds === 'high' || serverData.moderationNeeds === 'very_high') {
                            recommendationsHTML += `
                                <li>Enable full AI-powered auto-moderation with customized sensitivity</li>
                                <li>Implement advanced trust scoring system for members</li>
                                <li>Set up comprehensive auto-mod rules for all potential violation types</li>
                                <li>Create verification system for new members</li>
                                <li>Configure detailed moderation logging and analytics</li>
                                <li>Establish moderator roles with specific permissions and responsibilities</li>
                            `;
                        }
                        
                        recommendationsHTML += `
                                </ul>
                            </div>
                        `;
                        break;
                        
                    case 'custom_commands':
                        recommendationsHTML += `
                            <div class="ai-recommendation mb-4">
                                <h4>Custom Commands Recommendations</h4>
                                <p>For your ${serverData.purpose} server:</p>
                                
                                <ul>
                                    <li>Start with the ${serverData.purpose === 'gaming' || serverData.purpose === 'minecraft' || serverData.purpose === 'modding' ? 'gaming-focused' : 'basic'} command set</li>
                                    <li>Create custom commands for frequently asked questions in your community</li>
                                    <li>Set up role-assignment commands if you have a role system</li>
                                    <li>${serverData.purpose === 'minecraft' ? 'Create Minecraft server status commands' : 'Create informational commands about your community'}</li>
                                    <li>Enable advanced features to allow for dynamic command responses</li>
                                </ul>
                            </div>
                        `;
                        break;
                        
                    case 'minecraft':
                        recommendationsHTML += `
                            <div class="ai-recommendation mb-4">
                                <h4>Minecraft Integration Recommendations</h4>
                                <p>For your Minecraft-related server:</p>
                                
                                <ul>
                                    <li>Set up a dedicated server status channel that updates automatically</li>
                                    <li>Configure whitelist request system with customizable application questions</li>
                                    <li>Enable console access for administrators (with appropriate permissions)</li>
                                    <li>Set up player count tracking and statistics</li>
                                    <li>Create commands for checking mod compatibility and server information</li>
                                </ul>
                            </div>
                        `;
                        break;
                        
                    case 'ai':
                        recommendationsHTML += `
                            <div class="ai-recommendation mb-4">
                                <h4>AI Features Recommendations</h4>
                                <p>Based on your server profile:</p>
                                
                                <ul>
                                    <li>Create a dedicated AI interaction channel</li>
                                    <li>Set up appropriate usage limits to manage costs (${serverData.size === 'small' ? 'medium limits' : 'higher limits with role-based access'})
                                    <li>${serverData.purpose === 'minecraft' || serverData.purpose === 'modding' ? 'Configure AI to assist with Minecraft modding questions' : 'Configure AI to assist with community-specific topics'}</li>
                                    <li>Enable image generation for creative content</li>
                                    <li>${serverData.moderationNeeds === 'high' || serverData.moderationNeeds === 'very_high' ? 'Utilize AI for moderation assistance' : 'Keep AI moderation in assisted mode rather than automatic'}</li>
                                </ul>
                            </div>
                        `;
                        break;
                        
                    case 'twitch':
                        recommendationsHTML += `
                            <div class="ai-recommendation mb-4">
                                <h4>Twitch Integration Recommendations</h4>
                                <p>For your streaming community:</p>
                                
                                <ul>
                                    <li>Set up automated stream announcements</li>
                                    <li>Configure viewer points system with customizable rewards</li>
                                    <li>Create stream highlights channel for clips and memorable moments</li>
                                    <li>Enable streamer roles that are automatically assigned when live</li>
                                    <li>Set up stream milestone celebrations (followers, subscribers)</li>
                                </ul>
                            </div>
                        `;
                        break;
                        
                    case 'analytics':
                        recommendationsHTML += `
                            <div class="ai-recommendation mb-4">
                                <h4>Analytics Recommendations</h4>
                                <p>For effective server metrics:</p>
                                
                                <ul>
                                    <li>Track member activity patterns to optimize engagement</li>
                                    <li>Monitor channel usage to identify popular content</li>
                                    <li>Set up ${serverData.size === 'small' ? 'monthly' : 'weekly'} activity reports for administrators</li>
                                    <li>Track command usage to see which features are most valuable</li>
                                    <li>Monitor moderation actions to identify problem areas</li>
                                </ul>
                            </div>
                        `;
                        break;
                }
            });
            
            // Additional notes
            recommendationsHTML += `
                <div class="ai-recommendation">
                    <h4>Additional Notes</h4>
                    <p>These recommendations are tailored to your current server profile. As your community grows, you may want to adjust settings accordingly. All configurations can be modified through the dashboard or using Discord commands.</p>
                </div>
            `;
            
            aiRecommendationsElement.innerHTML = recommendationsHTML;
        }
        
        function generateSummary() {
            // Fill in summary information
            document.getElementById('summary-server-name').textContent = serverData.name;
            document.getElementById('summary-server-purpose').textContent = getPurposeLabel(serverData.purpose);
            document.getElementById('summary-server-size').textContent = getSizeLabel(serverData.size);
            document.getElementById('summary-activity-level').textContent = getActivityLabel(serverData.activityLevel);
            
            // Fill in selected features
            const summaryFeatures = document.getElementById('summary-features');
            let featuresHTML = '';
            
            selectedFeatures.forEach(feature => {
                featuresHTML += `
                    <div class="col-md-6">
                        <div class="summary-item">
                            <label>${getFeatureLabel(feature)}</label>
                            <div>Enabled</div>
                        </div>
                    </div>
                `;
            });
            
            summaryFeatures.innerHTML = featuresHTML;
            
            // Fill in configuration summary
            const summaryConfiguration = document.getElementById('summary-configuration');
            let configHTML = '';
            
            selectedFeatures.forEach(feature => {
                configHTML += `<h5>${getFeatureLabel(feature)}</h5><ul>`;
                
                if (serverData.featureSettings && serverData.featureSettings[feature]) {
                    for (const [key, value] of Object.entries(serverData.featureSettings[feature])) {
                        if (typeof value === 'boolean') {
                            configHTML += `<li>${formatSettingName(key)}: ${value ? 'Enabled' : 'Disabled'}</li>`;
                        } else {
                            configHTML += `<li>${formatSettingName(key)}: ${getSettingLabel(feature, key, value)}</li>`;
                        }
                    }
                }
                
                configHTML += `</ul>`;
            });
            
            summaryConfiguration.innerHTML = configHTML;
        }
        
        function submitConfiguration() {
            // Show processing overlay
            processingOverlay.classList.add('visible');
            
            // Collect all configuration data
            const configData = {
                serverInfo: serverData,
                selectedFeatures: selectedFeatures
            };
            
            // Send configuration to server
            fetch('/api/onboarding/configure', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(configData)
            })
            .then(response => response.json())
            .then(data => {
                // Hide processing overlay
                processingOverlay.classList.remove('visible');
                
                if (data.status === 'success') {
                    // Redirect to the dashboard or configuration complete page
                    window.location.href = data.redirectUrl || '/dashboard';
                } else {
                    alert('There was a problem configuring your bot: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error configuring bot:', error);
                processingOverlay.classList.remove('visible');
                alert('There was a problem configuring your bot. Please try again later.');
            });
        }
        
        // Helper functions for labels
        function getPurposeLabel(purpose) {
            const purposes = {
                'gaming': 'Gaming Community',
                'minecraft': 'Minecraft Server',
                'modding': 'Modding Community',
                'streaming': 'Streaming/Content Creation',
                'general': 'General Community',
                'education': 'Educational',
                'professional': 'Professional/Work',
                'other': 'Other'
            };
            
            return purposes[purpose] || purpose;
        }
        
        function getSizeLabel(size) {
            const sizes = {
                'small': 'Small (< 100 members)',
                'medium': 'Medium (100-500 members)',
                'large': 'Large (500-2000 members)',
                'very_large': 'Very Large (2000+ members)'
            };
            
            return sizes[size] || size;
        }
        
        function getActivityLabel(activity) {
            const activities = {
                'low': 'Low (A few messages per day)',
                'medium': 'Medium (Steady conversation throughout the day)',
                'high': 'High (Active conversations all day)',
                'very_high': 'Very High (Constant activity, multiple active channels)'
            };
            
            return activities[activity] || activity;
        }
        
        function getFeatureLabel(feature) {
            const features = {
                'moderation': 'Moderation System',
                'custom_commands': 'Custom Commands',
                'minecraft': 'Minecraft Integration',
                'ai': 'AI Features',
                'twitch': 'Twitch Integration',
                'analytics': 'Advanced Analytics'
            };
            
            return features[feature] || feature;
        }
        
        function formatSettingName(key) {
            return key
                .replace(/_/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }
        
        function getSettingLabel(feature, key, value) {
            // Special cases for specific settings
            if (feature === 'moderation' && key === 'automod_level') {
                const levels = {
                    'low': 'Low - Basic automod',
                    'medium': 'Medium - Standard protection',
                    'high': 'High - Strict moderation',
                    'custom': 'Custom - Manual configuration'
                };
                return levels[value] || value;
            }
            
            if (feature === 'ai' && key === 'ai_models') {
                const models = {
                    'both': 'Both Claude 3.5 and GPT-4o',
                    'claude': 'Claude 3.5 Only',
                    'gpt': 'GPT-4o Only'
                };
                return models[value] || value;
            }
            
            return value;
        }
    });
</script>
{% endblock %}