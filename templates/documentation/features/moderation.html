{% extends "base.html" %}

{% block title %}AstroBot Advanced Moderation System{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/documentation.css') }}">
{% endblock %}

{% block content %}
<div class="container documentation-container">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3 doc-sidebar">
            <div class="sticky-top pt-4">
                <h5>Documentation</h5>
                <hr>
                <div class="nav flex-column">
                    <a class="nav-link" href="{{ url_for('documentation_index') }}">Home</a>
                    
                    <div class="nav-group">
                        <h6>Getting Started</h6>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='guides', page_name='quickstart') }}">Quick Start Guide</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='guides', page_name='installation') }}">Installation</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='guides', page_name='configuration') }}">Configuration</a>
                    </div>
                    
                    <div class="nav-group">
                        <h6>Features</h6>
                        <a class="nav-link active" href="{{ url_for('documentation_page', page_type='features', page_name='moderation') }}">Moderation System</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='features', page_name='customcommands') }}">Custom Commands</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='features', page_name='minecraft') }}">Minecraft Integration</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='features', page_name='twitch') }}">Twitch Integration</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='features', page_name='ai') }}">AI Features</a>
                    </div>
                    
                    <div class="nav-group">
                        <h6>API Reference</h6>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='api', page_name='overview') }}">Overview</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='api', page_name='authentication') }}">Authentication</a>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='api', page_name='endpoints') }}">Endpoints</a>
                    </div>
                    
                    <div class="nav-group">
                        <h6>Community</h6>
                        <a class="nav-link" href="{{ url_for('documentation_page', page_type='guides', page_name='contributing') }}">Contributing</a>
                        <a class="nav-link" href="{{ url_for('feedback') }}">Feedback & Suggestions</a>
                        <a class="nav-link" href="https://discord.gg/astrobot" target="_blank">Discord Community</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-md-9 doc-content">
            <div class="doc-toc">
                <!-- Table of contents will be generated by JavaScript -->
            </div>
            
            <h1>Advanced Moderation System</h1>
            
            <p class="lead">
                AstroBot's Advanced Moderation System provides AI-powered moderation tools to keep your Discord server safe and well-managed. With sophisticated context analysis and configurable auto-moderation capabilities, it helps moderators efficiently handle issues and maintain a positive community environment.
            </p>
            
            <div class="doc-note">
                <h5><i class="fas fa-info-circle"></i> Note</h5>
                <p>The Advanced Moderation System requires appropriate bot permissions to function correctly. Ensure the bot has the <code>Manage Messages</code>, <code>Kick Members</code>, and <code>Ban Members</code> permissions for full functionality.</p>
            </div>
            
            <h2>Key Features</h2>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card h-100 feature-card">
                        <div class="card-header">
                            <h5><i class="fas fa-robot text-primary"></i> AI-Powered Context Analysis</h5>
                        </div>
                        <div class="card-body">
                            <p>AstroBot uses advanced AI models to analyze message context and intent, providing more accurate moderation than simple keyword filters.</p>
                            <ul>
                                <li>Detects toxic content even with obfuscation</li>
                                <li>Understands context and intent behind messages</li>
                                <li>Reduces false positives compared to traditional filters</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card h-100 feature-card">
                        <div class="card-header">
                            <h5><i class="fas fa-user-shield text-primary"></i> User Trust System</h5>
                        </div>
                        <div class="card-body">
                            <p>AstroBot maintains trust scores for users based on behavior, allowing for dynamic moderation thresholds.</p>
                            <ul>
                                <li>Automated trust score calculation</li>
                                <li>Adjusts moderation sensitivity per user</li>
                                <li>Rewards positive behavior over time</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card h-100 feature-card">
                        <div class="card-header">
                            <h5><i class="fas fa-shield-alt text-primary"></i> Configurable Auto-Moderation</h5>
                        </div>
                        <div class="card-body">
                            <p>Create custom auto-moderation rules tailored to your community's specific needs.</p>
                            <ul>
                                <li>Multiple rule types (regex, word filter, link filter, etc.)</li>
                                <li>Channel-specific rules and exemptions</li>
                                <li>Role-based exemptions for trusted users</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card h-100 feature-card">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-line text-primary"></i> Comprehensive Audit Logs</h5>
                        </div>
                        <div class="card-body">
                            <p>Keep track of all moderation actions and events with detailed, searchable audit logs.</p>
                            <ul>
                                <li>Customizable logging channels</li>
                                <li>Separate logs for different event types</li>
                                <li>Includes context and evidence for future reference</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2>Getting Started with Moderation</h2>
            
            <h3>Setting Up Moderation Log Channel</h3>
            <p>The first step is to set up a moderation log channel where AstroBot will report all moderation actions and events.</p>
            
            <div class="syntax-highlight">
                <div class="language-label">Discord Command</div>
                <pre><code>!modlog #mod-logs</code></pre>
            </div>
            
            <p>Replace <code>#mod-logs</code> with your preferred channel. This will be used for all moderation logs, including:</p>
            <ul>
                <li>User warnings, mutes, kicks, and bans</li>
                <li>Message deletions and edits</li>
                <li>Auto-moderation triggers</li>
                <li>Member join/leave events with suspicious activity flags</li>
            </ul>
            
            <div class="doc-tip">
                <h5><i class="fas fa-lightbulb"></i> Tip</h5>
                <p>Create a private channel visible only to moderators and administrators to keep sensitive moderation information secure.</p>
            </div>
            
            <h3>Basic Moderation Commands</h3>
            
            <p>AstroBot provides several basic moderation commands for managing your server:</p>
            
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Command</th>
                            <th>Description</th>
                            <th>Required Permission</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>!warn @user [level] [reason]</code></td>
                            <td>Issue a warning to a user with optional level (low, medium, high, severe) and reason</td>
                            <td>Manage Messages</td>
                        </tr>
                        <tr>
                            <td><code>!mute @user [duration] [reason]</code></td>
                            <td>Mute a user for the specified duration (in minutes) with optional reason</td>
                            <td>Manage Roles</td>
                        </tr>
                        <tr>
                            <td><code>!kick @user [reason]</code></td>
                            <td>Kick a user from the server with optional reason</td>
                            <td>Kick Members</td>
                        </tr>
                        <tr>
                            <td><code>!ban @user [duration] [delete_days] [reason]</code></td>
                            <td>Ban a user with optional duration (in days), message deletion days, and reason</td>
                            <td>Ban Members</td>
                        </tr>
                        <tr>
                            <td><code>!unban user_id [reason]</code></td>
                            <td>Unban a user by ID with optional reason</td>
                            <td>Ban Members</td>
                        </tr>
                        <tr>
                            <td><code>!purge [amount] [@user]</code></td>
                            <td>Delete a specified number of messages (1-100), optionally from a specific user</td>
                            <td>Manage Messages</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h3>Warning System</h3>
            
            <p>The warning system allows moderators to issue warnings with different severity levels that can trigger automated actions when thresholds are reached:</p>
            
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Warning Level</th>
                            <th>Color</th>
                            <th>Default Threshold</th>
                            <th>Automated Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Low</td>
                            <td><span class="badge bg-warning">Yellow</span></td>
                            <td>1 warning</td>
                            <td>None</td>
                        </tr>
                        <tr>
                            <td>Medium</td>
                            <td><span class="badge bg-warning text-dark">Orange</span></td>
                            <td>3 warnings</td>
                            <td>Mute (10 minutes)</td>
                        </tr>
                        <tr>
                            <td>High</td>
                            <td><span class="badge bg-danger">Red</span></td>
                            <td>5 warnings</td>
                            <td>Kick</td>
                        </tr>
                        <tr>
                            <td>Severe</td>
                            <td><span class="badge bg-danger">Dark Red</span></td>
                            <td>7 warnings</td>
                            <td>Ban (1 day)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="doc-note">
                <h5><i class="fas fa-info-circle"></i> Note</h5>
                <p>These thresholds and actions can be customized in the web dashboard under Moderation Settings.</p>
            </div>
            
            <h2>Auto-Moderation Configuration</h2>
            
            <h3>Managing Auto-Moderation Rules</h3>
            
            <p>AstroBot's auto-moderation system allows you to create custom rules for automatically detecting and responding to problematic content.</p>
            
            <div class="syntax-highlight">
                <div class="language-label">Discord Command</div>
                <pre><code>!automod add rule_name rule_type settings</code></pre>
            </div>
            
            <p>For example, to create a rule that filters offensive words:</p>
            
            <div class="syntax-highlight">
                <div class="language-label">Discord Command</div>
                <pre><code>!automod add offensive_words word_filter {"words": ["word1", "word2"], "action": "delete", "warning_level": "medium", "notify_user": true}</code></pre>
            </div>
            
            <h3>Available Rule Types</h3>
            
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Rule Type</th>
                            <th>Description</th>
                            <th>Required Settings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>regex</code></td>
                            <td>Filter messages using regular expressions</td>
                            <td><code>pattern</code>, <code>action</code></td>
                        </tr>
                        <tr>
                            <td><code>word_filter</code></td>
                            <td>Filter specific words or phrases</td>
                            <td><code>words</code>, <code>action</code></td>
                        </tr>
                        <tr>
                            <td><code>link_filter</code></td>
                            <td>Filter links containing specific domains</td>
                            <td><code>domains</code>, <code>action</code></td>
                        </tr>
                        <tr>
                            <td><code>spam_detection</code></td>
                            <td>Detect message spam</td>
                            <td><code>message_similarity_threshold</code>, <code>action</code></td>
                        </tr>
                        <tr>
                            <td><code>mention_limit</code></td>
                            <td>Limit the number of mentions in a message</td>
                            <td><code>max_mentions</code>, <code>action</code></td>
                        </tr>
                        <tr>
                            <td><code>attachment_filter</code></td>
                            <td>Filter attachments based on file extensions</td>
                            <td><code>allowed_extensions</code>, <code>action</code></td>
                        </tr>
                        <tr>
                            <td><code>ai_toxic_content</code></td>
                            <td>Use AI to detect toxic content that bypasses other filters</td>
                            <td><code>action</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h3>Available Actions</h3>
            
            <p>For each rule, you can specify an action to take when the rule is triggered:</p>
            
            <ul>
                <li><code>none</code>: Only log the violation, take no action</li>
                <li><code>delete</code>: Delete the offending message</li>
                <li><code>warn</code>: Delete the message and warn the user (specify <code>warning_level</code>)</li>
                <li><code>mute</code>: Delete the message and temporarily mute the user (specify <code>duration_minutes</code>)</li>
                <li><code>kick</code>: Delete the message and kick the user from the server</li>
                <li><code>ban</code>: Delete the message and ban the user (specify <code>duration_days</code> or leave null for permanent)</li>
            </ul>
            
            <h3>Rule Settings Example</h3>
            
            <div class="syntax-highlight">
                <div class="language-label">JSON</div>
                <pre><code>{
    "action": "warn",
    "warning_level": "medium",
    "notify_user": true,
    "min_trust_score": 0.3,
    "channel_list": "123456789,987654321",
    "exempt_roles": "moderator_role_id,admin_role_id",
    "send_notification": true,
    "notification_channel_id": "mod_channel_id"
}</code></pre>
            </div>
            
            <h2>User Trust System</h2>
            
            <p>AstroBot's trust system calculates a trust score for each user based on their behavior and account characteristics. This score affects how auto-moderation rules are applied.</p>
            
            <h3>Trust Score Factors</h3>
            
            <p>Trust scores range from 0.0 (untrusted) to 1.0 (fully trusted) and are determined by:</p>
            
            <ul>
                <li>Account age (older accounts receive higher scores)</li>
                <li>Time in server (longer membership increases score)</li>
                <li>Having a profile picture (slight boost)</li>
                <li>Having server roles (more roles increase score)</li>
                <li>Warning history (warnings decrease score)</li>
                <li>Moderation action history (actions decrease score)</li>
                <li>Positive contributions (increases score over time)</li>
            </ul>
            
            <p>To check a user's trust score:</p>
            
            <div class="syntax-highlight">
                <div class="language-label">Discord Command</div>
                <pre><code>!trust @user</code></pre>
            </div>
            
            <div class="doc-warning">
                <h5><i class="fas fa-exclamation-triangle"></i> Important</h5>
                <p>Trust scores are server-specific and not shared between Discord servers. A user's behavior on one server does not affect their trust score on another.</p>
            </div>
            
            <h2>Web Dashboard Configuration</h2>
            
            <p>For more advanced configuration, use the AstroBot web dashboard. Navigate to the Moderation section to access additional settings:</p>
            
            <ul>
                <li>Customizable warning thresholds and automated actions</li>
                <li>Visual rule builder for complex auto-moderation rules</li>
                <li>Role permission configuration for moderation commands</li>
                <li>Log channel settings for different event types</li>
                <li>Trust score adjustment and visualization</li>
                <li>Moderation action statistics and analytics</li>
            </ul>
            
            <img src="{{ url_for('static', filename='documentation/img/moderation-dashboard.png') }}" class="doc-image" alt="Moderation Dashboard Screenshot">
            
            <h2>Advanced Usage</h2>
            
            <h3>Context-Aware Moderation</h3>
            
            <p>The AI-powered moderation system analyzes conversation context to better understand message intent. This reduces false positives by considering:</p>
            
            <ul>
                <li>Previous messages in the conversation</li>
                <li>Channel topic and purpose</li>
                <li>User behavior patterns</li>
                <li>Message tone and intent</li>
            </ul>
            
            <h3>Ban Evasion Detection</h3>
            
            <p>AstroBot includes sophisticated ban evasion detection that flags suspicious new accounts that may be attempting to evade previous bans. Suspicious accounts are:</p>
            
            <ul>
                <li>Automatically assigned a lower initial trust score</li>
                <li>Flagged in the moderation logs for review</li>
                <li>Subject to stricter auto-moderation rules</li>
            </ul>
            
            <h3>API Integration</h3>
            
            <p>Advanced users can leverage the AstroBot API to extend moderation capabilities further:</p>
            
            <div class="syntax-highlight">
                <div class="language-label">Python</div>
                <pre><code>import requests

API_KEY = "your_api_key"
SERVER_ID = "your_server_id"

# Get moderation logs
response = requests.get(
    f"https://api.astrobot.app/v1/servers/{SERVER_ID}/moderation/logs",
    headers={"Authorization": f"Bearer {API_KEY}"}
)

logs = response.json()
print(f"Retrieved {len(logs)} moderation logs")</code></pre>
            </div>
            
            <p>For more information on API usage, see the <a href="{{ url_for('documentation_page', page_type='api', page_name='overview') }}">API Reference</a>.</p>
            
            <div class="doc-feedback">
                <h5>Was this documentation helpful?</h5>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-success feedback-yes">Yes</button>
                    <button type="button" class="btn btn-outline-danger feedback-no">No</button>
                </div>
                
                <div class="feedback-form d-none mt-3">
                    <form>
                        <div class="form-group">
                            <label for="feedback-comment">What would make this documentation more helpful?</label>
                            <textarea class="form-control" id="feedback-comment" rows="3" placeholder="Your feedback"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary mt-2">Submit Feedback</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/documentation.js') }}"></script>
{% endblock %}